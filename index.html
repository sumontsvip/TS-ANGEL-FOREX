<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TS Angel Signal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h2 {
      margin-bottom: 10px;
    }
    select, button {
      padding: 8px 12px;
      margin-right: 10px;
      margin-bottom: 15px;
      font-size: 16px;
    }
    #signalBox {
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <h2>ğŸ“¡ Live Signal System â€” TS Angel</h2>
  <select id="pairSelect">
    <option value="XAUUSD">XAUUSD (Gold)</option>
    <option value="BTCUSD">BTCUSD (Coming Soon)</option>
  </select>
  <button onclick="generateSignal()">ğŸ”® Generate Signal</button>

  <div id="signalBox">ğŸ”” Click 'Generate Signal' to get started...</div>

  <!-- âœ… Drawing Pad Section -->
  <div style="margin-top: 20px;">
    <h3>âœï¸ Draw your zones or analysis:</h3>
    <canvas id="drawCanvas" width="360" height="300" style="border:1px solid #ccc; background: #fff;"></canvas><br>
    <button onclick="setTool('pen')">ğŸ–Šï¸ Pen</button>
    <button onclick="setTool('eraser')">ğŸ©¹ Eraser</button>
    <button onclick="clearCanvas()">ğŸ—‘ï¸ Clear</button>
  </div>

  <script>
    // ğŸ¤ Voice setup: Bengali female
    const synth = window.speechSynthesis;
    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "bn-BD";
      const voices = synth.getVoices();
      const femaleVoice = voices.find(v => v.lang.startsWith("bn") && v.name.toLowerCase().includes("female")) ||
                          voices.find(v => v.lang.startsWith("bn")) ||
                          voices.find(v => v.lang.startsWith("en") && v.name.toLowerCase().includes("female"));
      if (femaleVoice) utter.voice = femaleVoice;
      synth.speak(utter);
    }

    let activeSignal = null;
    const pairSelect = document.getElementById("pairSelect");
    const signalBox = document.getElementById("signalBox");

    async function fetchLivePrice(pair) {
      try {
        const response = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${pair}`);
        const data = await response.json();
        return parseFloat(data.price);
      } catch (error) {
        signalBox.innerHTML = "âŒ Failed to fetch price.";
        speak("Price fetch korte problem hocche");
        return null;
      }
    }

    async function generateSignal() {
      const now = new Date();
      const pair = pairSelect.value;
      const day = now.getDay();
      const time = now.toLocaleTimeString("en-IN", { hour12: true });

      if (activeSignal) {
        const msg = "â³ Wait: A signal is already active!";
        signalBox.innerHTML = msg;
        speak("Akti signal already active ache, wait korun.");
        return;
      }

      if ((pair === "XAUUSD") && (day === 6 || day === 0)) {
        const msg = "âš ï¸ Gold market is closed today.";
        signalBox.innerHTML = msg;
        speak("Gold market closed ache ajke.");
        return;
      }

      const price = await fetchLivePrice(pair);
      if (!price) return;

      if (pair === "XAUUSD") {
        const dailyBias = price > 3350.5 ? "BUY" : "SELL";
        const momentumSell = price < 3377.28;
        const momentumBuy = price > 3377.28;
        const entryZones = momentumSell ? [3372, 3370, 3365, 3360, 3356, 3351] : [3381, 3385, 3389, 3394];
        const inZone = entryZones.some(level => Math.abs(price - level) <= 0.5);

        if (!inZone) {
          const msg = `âŒ No valid trade setup now.\nPrice not near any key zone.\nCurrent: ${price}`;
          signalBox.innerHTML = msg.replace(/\n/g, '<br>');
          speak("Konotai trade korar setup nei. Price key zone er kache nai.");
          return;
        }

        const direction = momentumSell ? "SELL" : "BUY";
        const entry = parseFloat(price.toFixed(2));
        const tp1 = direction === "BUY" ? (entry + 5).toFixed(2) : (entry - 5).toFixed(2);
        const tp2 = direction === "BUY" ? (entry + 10).toFixed(2) : (entry - 10).toFixed(2);
        const tp3 = direction === "BUY" ? (entry + 15).toFixed(2) : (entry - 15).toFixed(2);
        const sl = direction === "BUY" ? (entry - 4).toFixed(2) : (entry + 4).toFixed(2);

        activeSignal = { pair, direction, entry, tp1, tp2, tp3, sl, time, mode: "Intraday", status: "Running" };

        const signalText =
          `ğŸ“Š ${pair}: ${direction}\nâš™ï¸ Mode: Intraday\nğŸŸ¡ Entry: ${entry}\nğŸ¯ TP1: ${tp1} | TP2: ${tp2} | TP3: ${tp3}\nğŸ›‘ SL: ${sl}\nğŸ“ Live Price: ${price}\nğŸ“ˆ Trade is live...`;

        signalBox.innerHTML = signalText.replace(/\n/g, "<br>");
        speak(`${pair} ${direction}. Entry ${entry}. TP1 ${tp1}, TP2 ${tp2}, SL ${sl}`);
      } else {
        signalBox.innerHTML = "âš ï¸ BTC signal logic not updated yet.";
        speak("BTC logic ajke update hoy nai.");
      }
    }

    // ğŸ–Œï¸ Drawing Features
    let tool = "pen";
    let drawing = false;
    const canvas = document.getElementById("drawCanvas");
    const ctx = canvas.getContext("2d");

    canvas.addEventListener("mousedown", () => drawing = true);
    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mouseout", () => drawing = false);
    canvas.addEventListener("mousemove", draw);

    function setTool(selected) {
      tool = selected;
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function draw(e) {
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      ctx.lineWidth = 3;
      ctx.lineCap = "round";

      ctx.strokeStyle = (tool === "pen") ? "black" : "white";
      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    // Load voices on page load
    window.speechSynthesis.onvoiceschanged = () => {
      // trigger voice list refresh for female Bangla
    };
  </script>
</body>
</html>
