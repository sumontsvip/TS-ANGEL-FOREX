<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>TS Angel Signal System</title>
  <style>
    body {
      background-color: black;
      color: #0ff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      color: #0ff;
    }
    #signalBox {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #0ff;
      border-radius: 5px;
      background: rgba(0, 255, 255, 0.1);
    }
    iframe {
      margin-top: 20px;
      width: 100%;
      height: 400px;
      border: none;
    }
    select, button {
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“¡ TS Angel Signal System</h1>
  <select id="pairSelect">
    <option value="XAUUSD">Gold (XAUUSD)</option>
    <option value="BTCUSD">Bitcoin (BTCUSD)</option>
  </select>
  <button onclick="generateSignal()">ğŸ“Š Generate Signal</button>

  <div id="signalBox">ğŸ“¢ Signal will appear here...</div>

  <iframe id="tvChart" src="https://s.tradingview.com/widgetembed/?symbol=FX_IDC:XAUUSD&interval=1&theme=dark&style=1&timezone=Asia/Kolkata&locale=en"></iframe>

  <script>
    const signalBox = document.getElementById("signalBox");
    const pairSelect = document.getElementById("pairSelect");
    const synth = window.speechSynthesis;
    let voice;

    function loadVoice() {
      const voices = synth.getVoices();
      voice = voices.find(v => v.lang === "bn-IN" && v.name.toLowerCase().includes("female")) || voices.find(v => v.lang === "bn-IN");
    }

    loadVoice();
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoice;
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.voice = voice;
      synth.cancel();
      synth.speak(utterance);
    }

    async function fetchPrice(pair) {
      try {
        if (pair === "BTCUSD") {
          const res = await fetch("https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT");
          const data = await res.json();
          return parseFloat(data.price);
        } else {
          const res = await fetch("https://api.twelvedata.com/price?symbol=XAU/USD&apikey=cd96961a49e242fe939a80866e70c57d");
          const data = await res.json();
          return parseFloat(data.price);
        }
      } catch (e) {
        signalBox.innerText = "âŒ Price fetch failed!";
        console.error(e);
        return null;
      }
    }

    async function generateSignal() {
      const pair = pairSelect.value;
      const price = await fetchPrice(pair);
      if (!price) return;

      let direction = price > 3377 ? "SELL" : "BUY";
      let entry = price.toFixed(2);
      let tp1 = direction === "BUY" ? (price + 5).toFixed(2) : (price - 5).toFixed(2);
      let sl = direction === "BUY" ? (price - 4).toFixed(2) : (price + 4).toFixed(2);

      const signalText = `ğŸ“Š ${pair}: ${direction}
ğŸ”¹ Entry: ${entry}
ğŸ¯ TP1: ${tp1}
ğŸ›‘ SL: ${sl}
ğŸ“ Price: ${price}`;

      signalBox.innerText = signalText;
      speak(`${pair} ${direction}. Entry ${entry}. TP1 ${tp1}, Stoploss ${sl}`);

      // Update TradingView chart pair
      const tvChart = document.getElementById("tvChart");
      tvChart.src = `https://s.tradingview.com/widgetembed/?symbol=FX_IDC:${pair}&interval=1&theme=dark&style=1&timezone=Asia/Kolkata&locale=en`;
    }
  </script>
</body>
</html>
